<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="author" content="Benedek Andras Rozemberczki" />

<meta name="date" content="2016-02-21" />

<title>Data Science for Business Project - Part I. Data Cleaning</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; }
code > span.dt { color: #902000; }
code > span.dv { color: #40a070; }
code > span.bn { color: #40a070; }
code > span.fl { color: #40a070; }
code > span.ch { color: #4070a0; }
code > span.st { color: #4070a0; }
code > span.co { color: #60a0b0; font-style: italic; }
code > span.ot { color: #007020; }
code > span.al { color: #ff0000; font-weight: bold; }
code > span.fu { color: #06287e; }
code > span.er { color: #ff0000; font-weight: bold; }
</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<link href="data:text/css,body%20%7B%0A%20%20background%2Dcolor%3A%20%23fff%3B%0A%20%20margin%3A%201em%20auto%3B%0A%20%20max%2Dwidth%3A%20700px%3B%0A%20%20overflow%3A%20visible%3B%0A%20%20padding%2Dleft%3A%202em%3B%0A%20%20padding%2Dright%3A%202em%3B%0A%20%20font%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0A%20%20font%2Dsize%3A%2014px%3B%0A%20%20line%2Dheight%3A%201%2E35%3B%0A%7D%0A%0A%23header%20%7B%0A%20%20text%2Dalign%3A%20center%3B%0A%7D%0A%0A%23TOC%20%7B%0A%20%20clear%3A%20both%3B%0A%20%20margin%3A%200%200%2010px%2010px%3B%0A%20%20padding%3A%204px%3B%0A%20%20width%3A%20400px%3B%0A%20%20border%3A%201px%20solid%20%23CCCCCC%3B%0A%20%20border%2Dradius%3A%205px%3B%0A%0A%20%20background%2Dcolor%3A%20%23f6f6f6%3B%0A%20%20font%2Dsize%3A%2013px%3B%0A%20%20line%2Dheight%3A%201%2E3%3B%0A%7D%0A%20%20%23TOC%20%2Etoctitle%20%7B%0A%20%20%20%20font%2Dweight%3A%20bold%3B%0A%20%20%20%20font%2Dsize%3A%2015px%3B%0A%20%20%20%20margin%2Dleft%3A%205px%3B%0A%20%20%7D%0A%0A%20%20%23TOC%20ul%20%7B%0A%20%20%20%20padding%2Dleft%3A%2040px%3B%0A%20%20%20%20margin%2Dleft%3A%20%2D1%2E5em%3B%0A%20%20%20%20margin%2Dtop%3A%205px%3B%0A%20%20%20%20margin%2Dbottom%3A%205px%3B%0A%20%20%7D%0A%20%20%23TOC%20ul%20ul%20%7B%0A%20%20%20%20margin%2Dleft%3A%20%2D2em%3B%0A%20%20%7D%0A%20%20%23TOC%20li%20%7B%0A%20%20%20%20line%2Dheight%3A%2016px%3B%0A%20%20%7D%0A%0Atable%20%7B%0A%20%20margin%3A%201em%20auto%3B%0A%20%20border%2Dwidth%3A%201px%3B%0A%20%20border%2Dcolor%3A%20%23DDDDDD%3B%0A%20%20border%2Dstyle%3A%20outset%3B%0A%20%20border%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0A%20%20border%2Dwidth%3A%202px%3B%0A%20%20padding%3A%205px%3B%0A%20%20border%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0A%20%20border%2Dwidth%3A%201px%3B%0A%20%20border%2Dstyle%3A%20inset%3B%0A%20%20line%2Dheight%3A%2018px%3B%0A%20%20padding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0A%20%20border%2Dleft%2Dstyle%3A%20none%3B%0A%20%20border%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0A%20%20background%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0A%0Ap%20%7B%0A%20%20margin%3A%200%2E5em%200%3B%0A%7D%0A%0Ablockquote%20%7B%0A%20%20background%2Dcolor%3A%20%23f6f6f6%3B%0A%20%20padding%3A%200%2E25em%200%2E75em%3B%0A%7D%0A%0Ahr%20%7B%0A%20%20border%2Dstyle%3A%20solid%3B%0A%20%20border%3A%20none%3B%0A%20%20border%2Dtop%3A%201px%20solid%20%23777%3B%0A%20%20margin%3A%2028px%200%3B%0A%7D%0A%0Adl%20%7B%0A%20%20margin%2Dleft%3A%200%3B%0A%7D%0A%20%20dl%20dd%20%7B%0A%20%20%20%20margin%2Dbottom%3A%2013px%3B%0A%20%20%20%20margin%2Dleft%3A%2013px%3B%0A%20%20%7D%0A%20%20dl%20dt%20%7B%0A%20%20%20%20font%2Dweight%3A%20bold%3B%0A%20%20%7D%0A%0Aul%20%7B%0A%20%20margin%2Dtop%3A%200%3B%0A%7D%0A%20%20ul%20li%20%7B%0A%20%20%20%20list%2Dstyle%3A%20circle%20outside%3B%0A%20%20%7D%0A%20%20ul%20ul%20%7B%0A%20%20%20%20margin%2Dbottom%3A%200%3B%0A%20%20%7D%0A%0Apre%2C%20code%20%7B%0A%20%20background%2Dcolor%3A%20%23f7f7f7%3B%0A%20%20border%2Dradius%3A%203px%3B%0A%20%20color%3A%20%23333%3B%0A%7D%0Apre%20%7B%0A%20%20white%2Dspace%3A%20pre%2Dwrap%3B%20%20%20%20%2F%2A%20Wrap%20long%20lines%20%2A%2F%0A%20%20border%2Dradius%3A%203px%3B%0A%20%20margin%3A%205px%200px%2010px%200px%3B%0A%20%20padding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0A%20%20background%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0A%0Acode%20%7B%0A%20%20font%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0A%20%20font%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0A%20%20padding%3A%202px%200px%3B%0A%7D%0A%0Adiv%2Efigure%20%7B%0A%20%20text%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0A%20%20background%2Dcolor%3A%20%23FFFFFF%3B%0A%20%20padding%3A%202px%3B%0A%20%20border%3A%201px%20solid%20%23DDDDDD%3B%0A%20%20border%2Dradius%3A%203px%3B%0A%20%20border%3A%201px%20solid%20%23CCCCCC%3B%0A%20%20margin%3A%200%205px%3B%0A%7D%0A%0Ah1%20%7B%0A%20%20margin%2Dtop%3A%200%3B%0A%20%20font%2Dsize%3A%2035px%3B%0A%20%20line%2Dheight%3A%2040px%3B%0A%7D%0A%0Ah2%20%7B%0A%20%20border%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0A%20%20padding%2Dtop%3A%2010px%3B%0A%20%20padding%2Dbottom%3A%202px%3B%0A%20%20font%2Dsize%3A%20145%25%3B%0A%7D%0A%0Ah3%20%7B%0A%20%20border%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0A%20%20padding%2Dtop%3A%2010px%3B%0A%20%20font%2Dsize%3A%20120%25%3B%0A%7D%0A%0Ah4%20%7B%0A%20%20border%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0A%20%20margin%2Dleft%3A%208px%3B%0A%20%20font%2Dsize%3A%20105%25%3B%0A%7D%0A%0Ah5%2C%20h6%20%7B%0A%20%20border%2Dbottom%3A%201px%20solid%20%23ccc%3B%0A%20%20font%2Dsize%3A%20105%25%3B%0A%7D%0A%0Aa%20%7B%0A%20%20color%3A%20%230033dd%3B%0A%20%20text%2Ddecoration%3A%20none%3B%0A%7D%0A%20%20a%3Ahover%20%7B%0A%20%20%20%20color%3A%20%236666ff%3B%20%7D%0A%20%20a%3Avisited%20%7B%0A%20%20%20%20color%3A%20%23800080%3B%20%7D%0A%20%20a%3Avisited%3Ahover%20%7B%0A%20%20%20%20color%3A%20%23BB00BB%3B%20%7D%0A%20%20a%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0A%20%20%20%20text%2Ddecoration%3A%20underline%3B%20%7D%0A%20%20a%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0A%20%20%20%20text%2Ddecoration%3A%20underline%3B%20%7D%0A%0A%2F%2A%20Class%20described%20in%20https%3A%2F%2Fbenjeffrey%2Ecom%2Fposts%2Fpandoc%2Dsyntax%2Dhighlighting%2Dcss%0A%20%20%20Colours%20from%20https%3A%2F%2Fgist%2Egithub%2Ecom%2Frobsimmons%2F1172277%20%2A%2F%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%2F%2A%20Keyword%20%2A%2F%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%2F%2A%20DataType%20%2A%2F%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%2F%2A%20DecVal%20%28decimal%20values%29%20%2A%2F%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%2F%2A%20BaseN%20%2A%2F%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%2F%2A%20Float%20%2A%2F%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%2F%2A%20Char%20%2A%2F%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%2F%2A%20String%20%2A%2F%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%2F%2A%20Comment%20%2A%2F%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%2F%2A%20OtherToken%20%2A%2F%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%2F%2A%20AlertToken%20%2A%2F%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%2F%2A%20Function%20calls%20%2A%2F%20%0Acode%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%2F%2A%20ErrorTok%20%2A%2F%0A%0A" rel="stylesheet" type="text/css" />

</head>

<body>



<div id="header">
<h1 class="title">Data Science for Business Project - Part I. Data Cleaning</h1>
<h4 class="author"><em>Benedek Andras Rozemberczki</em></h4>
<h4 class="date"><em>2016-02-21</em></h4>
</div>


<div id="the-dataset-used-for-the-analysis." class="section level2">
<h2>The dataset used for the analysis.</h2>
<p>The dataset used for the project is from and describes the properties of used cars sold at three different auction sites. Originally it has the name . A number of cars is actually a lemon (the buyer of the car is being kicked), which means that it is sold well above price and the car is itself useless scrap metal. The goal of the machine learning exercise is to predict whether a car is a lemon or not – so essentially the supervised problem is classification into the binary class bad buy or not. The original labeled data set has <span class="math">\(N = 72983\)</span> observations, and this is later separated into training and test sets. The number of possible predictors initially is <span class="math">\(p = 33\)</span>, but this includes the identification number that I drop in the first step of my analysis.</p>
</div>
<div id="initialization" class="section level2">
<h2>Initialization</h2>
<p>A number of steps such as the building of random forests and the test-training separation, uses random number generation so I set the random seed as a first step – this also makes results reproducible. Later I load in the libraries needed for the cleaning of the dataset.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.seed</span>(<span class="dv">2016</span>)
<span class="kw">library</span>(plyr)
<span class="kw">library</span>(dummies)</code></pre>
</div>
<div id="loading-the-dataset" class="section level2">
<h2>Loading the dataset</h2>
<p>The dataset is stored in a comma separated values files, where the separators are semicolons. The dataset is loaded into the dataframed named as DF. The description of the variables is in a text file. I load into R as a dataframe called Description.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">setwd</span>(<span class="st">&quot;C:/Users/Benedek/Dropbox/V. Semester/Data Science for Business/Final project/Dataset&quot;</span>)
DF &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;training.csv&quot;</span>, <span class="dt">header =</span> <span class="ot">TRUE</span>, <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)
Description &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;Description.txt&quot;</span>, <span class="dt">header =</span> <span class="ot">TRUE</span>, <span class="dt">sep =</span> <span class="st">&quot;;&quot;</span>, <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)</code></pre>
</div>
<div id="dropping-the-id-variable-and-extracting-engine-properties" class="section level2">
<h2>Dropping the ID variable and extracting engine properties</h2>
<p>The first variable is an ID of the observations, to prevent data leakage I drop it from the dataset. Importantly the Model and Submodel variables are stored as string. They contain valuable information about the driving system of the car, the number of cylinders. Moreover, the strings alos describes whether the engine uses one of the following:</p>
<ul>
<li>Sequential Multiport Fuel Injection</li>
<li>Sequential Fuel Injection</li>
<li>Multiport Fuel Injection</li>
<li>Double Overhead Camshaft</li>
</ul>
<p>As a matter of fact this is not stated explicitly by Kaggle, so as part of my project I looked up what is the exact meaning of the abbrevations. I also took a look at the unique values of the Model and Submodel variables to get ideas about potential predictor extractions. The different engine properties are encoded as dummies, the dummy variables take the value 1, when a the engine of the car has the property described the variable.</p>
<pre class="sourceCode r"><code class="sourceCode r">DF &lt;-<span class="st"> </span>DF[,-<span class="dv">1</span>]

Extract &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;4WD&quot;</span>,<span class="st">&quot;2WD&quot;</span>,<span class="st">&quot;AWD&quot;</span>,<span class="st">&quot;FWD&quot;</span>,<span class="st">&quot;V8&quot;</span>,<span class="st">&quot;V6&quot;</span>,<span class="st">&quot;4C&quot;</span>,<span class="st">&quot;6C&quot;</span>,<span class="st">&quot;DOHC&quot;</span>,<span class="st">&quot;MPI&quot;</span>,<span class="st">&quot;SF&quot;</span>,<span class="st">&quot;MFI&quot;</span>,<span class="st">&quot;EF&quot;</span>)

for ( i in <span class="dv">1</span>:<span class="kw">length</span>(Extract)){
  DF[,<span class="dv">33</span>+i] &lt;-<span class="st"> </span><span class="dv">0</span>
  DF[,<span class="dv">33</span>+i][<span class="kw">grep</span>(Extract[i], DF$Model)] &lt;-<span class="st"> </span><span class="dv">1</span>  
  DF[,<span class="dv">33</span>+i][<span class="kw">grep</span>(Extract[i], DF$SubModel)] &lt;-<span class="st"> </span><span class="dv">1</span>}

<span class="kw">colnames</span>(DF)[<span class="dv">34</span>:<span class="dv">46</span>] &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;WD4&quot;</span>,<span class="st">&quot;WD2&quot;</span>,<span class="st">&quot;AWD&quot;</span>,<span class="st">&quot;FWD&quot;</span>,<span class="st">&quot;V8&quot;</span>,<span class="st">&quot;V6&quot;</span>,<span class="st">&quot;C4&quot;</span>,<span class="st">&quot;C6&quot;</span>,<span class="st">&quot;DOHC&quot;</span>,<span class="st">&quot;MPI&quot;</span>,<span class="st">&quot;SF&quot;</span>,<span class="st">&quot;MFI&quot;</span>,<span class="st">&quot;EF&quot;</span>)</code></pre>
</div>
<div id="the-number-of-injectors" class="section level2">
<h2>The number of injectors</h2>
<p>The dataset describes the number of injectors in the engine, to extract these I used the grep function. It worth emphasizing that this property is described in 3 differnt ways, without whitespace, with a whitespace and with a “-” sign.</p>
<pre class="sourceCode r"><code class="sourceCode r">DF$I4 &lt;-<span class="st"> </span><span class="dv">0</span>
DF$I4[<span class="kw">grep</span>(<span class="st">&quot;I4&quot;</span>, DF$Model)] &lt;-<span class="st"> </span><span class="dv">1</span>
DF$I4[<span class="kw">grep</span>(<span class="st">&quot;I 4&quot;</span>, DF$Model)] &lt;-<span class="st"> </span><span class="dv">1</span>
DF$I4[<span class="kw">grep</span>(<span class="st">&quot;I-4&quot;</span>, DF$Model)] &lt;-<span class="st"> </span><span class="dv">1</span>

DF$I6 &lt;-<span class="st"> </span><span class="dv">0</span>
DF$I6[<span class="kw">grep</span>(<span class="st">&quot;I6&quot;</span>, DF$Model)] &lt;-<span class="st"> </span><span class="dv">1</span>
DF$I6[<span class="kw">grep</span>(<span class="st">&quot;I 6&quot;</span>, DF$Model)] &lt;-<span class="st"> </span><span class="dv">1</span>
DF$I6[<span class="kw">grep</span>(<span class="st">&quot;I-6&quot;</span>, DF$Model)] &lt;-<span class="st"> </span><span class="dv">1</span></code></pre>
</div>
<div id="engine-size" class="section level2">
<h2>Engine size</h2>
<p>The size of the engine is encoded in the Model and Submodel variables, but these variables are still strings, the size of the engine varies from 1.4L (small smart car) to 8.9L (large truck). To extract the engine size I use a the grep function and two for loops that combine the two digits. The baseline engine variable value is missing. In the end the string is encoded as a factor variable. At the end of the cleaning process the variable is encoded into different dummy variables.</p>
<pre class="sourceCode r"><code class="sourceCode r">firstdigits &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;1&quot;</span>,<span class="st">&quot;2&quot;</span>,<span class="st">&quot;3&quot;</span>,<span class="st">&quot;4&quot;</span>,<span class="st">&quot;5&quot;</span>,<span class="st">&quot;6&quot;</span>,<span class="st">&quot;7&quot;</span>,<span class="st">&quot;8&quot;</span>)
seconddigits &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;0&quot;</span>,<span class="st">&quot;1&quot;</span>,<span class="st">&quot;2&quot;</span>,<span class="st">&quot;3&quot;</span>,<span class="st">&quot;4&quot;</span>,<span class="st">&quot;5&quot;</span>,<span class="st">&quot;6&quot;</span>,<span class="st">&quot;7&quot;</span>,<span class="st">&quot;8&quot;</span>,<span class="st">&quot;9&quot;</span>)
DF$EngineSize &lt;-<span class="st"> &quot;Missing&quot;</span>

for (first in firstdigits){
  for (second in seconddigits){
    
    Check &lt;-<span class="st"> </span><span class="kw">paste0</span>(first,<span class="st">&quot;.&quot;</span>,second,<span class="st">&quot;L&quot;</span>)
    DF$EngineSize[<span class="kw">grep</span>(Check,DF$Model)] &lt;-<span class="st"> </span>Check
    DF$EngineSize[<span class="kw">grep</span>(Check,DF$SubModel)] &lt;-<span class="st"> </span>Check
  
    check &lt;-<span class="st"> </span><span class="kw">paste0</span>(first,<span class="st">&quot;.&quot;</span>,second,<span class="st">&quot;l&quot;</span>)
    DF$EngineSize[<span class="kw">grep</span>(check,DF$Model)] &lt;-<span class="st"> </span>Check
    DF$EngineSize[<span class="kw">grep</span>(check,DF$SubModel)] &lt;-<span class="st"> </span>Check
  }
}
DF$EngineSize &lt;-<span class="st"> </span><span class="kw">as.factor</span>(DF$EngineSize)</code></pre>
</div>
<div id="bodye-of-the-car" class="section level2">
<h2>Bodye of the car</h2>
<p>The submodel variable contains the body type as strings namely the following body types are differentiated in the dataset: * Wagon * Pickup * Minivan * Coupe * Sedan * External Cabrio * Quad</p>
<pre class="sourceCode r"><code class="sourceCode r">Type_of_Body &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;WAGON&quot;</span>,<span class="st">&quot;PICKUP&quot;</span>,<span class="st">&quot;MINIVAN&quot;</span>,<span class="st">&quot;COUPE&quot;</span>,<span class="st">&quot;SEDAN&quot;</span>,<span class="st">&quot;EXT CAB&quot;</span>,<span class="st">&quot;QUAD&quot;</span>)

for (j in <span class="dv">1</span>:<span class="kw">length</span>(Type_of_Body)){
  DF[,<span class="dv">49</span>+j] &lt;-<span class="st"> </span><span class="dv">0</span>
  DF[,<span class="dv">49</span>+j][<span class="kw">grep</span>(Type_of_Body[j], DF$SubModel)] &lt;-<span class="st"> </span><span class="dv">1</span>
  }

<span class="kw">colnames</span>(DF)[<span class="dv">50</span>:<span class="dv">56</span>] &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;WAGON&quot;</span>,<span class="st">&quot;PICKUP&quot;</span>,<span class="st">&quot;MINIVAN&quot;</span>,<span class="st">&quot;COUPE&quot;</span>,<span class="st">&quot;SEDAN&quot;</span>,<span class="st">&quot;EXTCAB&quot;</span>,<span class="st">&quot;QUAD&quot;</span>)</code></pre>
</div>
<div id="date-of-the-purchase" class="section level2">
<h2>Date of the purchase</h2>
<p>The purchase date of the car is in a string. The year, month and day is separated by a dash. I strip the original date vector based on the dash, the first part is saved as month, the second as day and third as the year. These are saved as different factor variables. As a last step they are column binded to the main dataframe.</p>
<pre class="sourceCode r"><code class="sourceCode r">DF$PurchDate &lt;-<span class="st"> </span><span class="kw">as.character</span>(DF$PurchDate)
Dateelements &lt;-<span class="st"> </span><span class="kw">strsplit</span>(DF$PurchDate, <span class="st">&quot;/&quot;</span>)
N &lt;-<span class="st"> </span><span class="kw">nrow</span>(DF)
Year =<span class="st"> </span>Day =<span class="st"> </span>Month =<span class="st"> </span><span class="dv">1</span>:N

for (i in <span class="dv">1</span>:N){
  
  if ( i%%<span class="st"> </span><span class="dv">1000</span> ==<span class="dv">1</span>){<span class="kw">print</span>(i)}
  
  Element &lt;-<span class="st"> </span>Dateelements[[i]]
  Month[i] &lt;-<span class="st"> </span>Element[<span class="dv">1</span>]
  Day[i] &lt;-<span class="st"> </span>Element[<span class="dv">2</span>]
  Year[i] &lt;-<span class="st"> </span>Element[<span class="dv">3</span>]
}

Day &lt;-<span class="st">  </span><span class="kw">as.factor</span>(Day)
Month &lt;-<span class="st">  </span><span class="kw">as.factor</span>(Month)
Year &lt;-<span class="st">  </span><span class="kw">as.factor</span>(Year)
DF &lt;-<span class="st"> </span><span class="kw">cbind</span>(DF,Day,Month,Year)</code></pre>
</div>
<div id="common-group-for-low-frequency-values-in-trim" class="section level2">
<h2>Common group for low frequency values in Trim</h2>
<p>The trim variables has a large number of values that have a low occurence (only 5-200 instances). These occurences are merged into one signle group in this step. The cutoff is chosen at 200. This results altogether in 43 unique categoires in the Trim variable – including the large group that contains the merged categories with low counts.</p>
<p>As a last step the previously used string variabels such as Date, Model, Submodel and Trim are dropped from the main dataframe.</p>
<pre class="sourceCode r"><code class="sourceCode r">Trim_drops &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(<span class="kw">count</span>(DF, <span class="st">'Trim'</span>))
Trim_drops &lt;-<span class="st"> </span>Trim_drops[Trim_drops$freq &gt;<span class="st"> </span><span class="dv">200</span>,]
DF$Trim_encoded &lt;-<span class="st"> &quot;Other&quot;</span>

for (Checkup in Trim_drops[,<span class="dv">1</span>]){DF$Trim_encoded[DF$Trim ==<span class="st"> </span>Checkup] &lt;-<span class="st"> </span>Checkup}

DF$Trim_encoded &lt;-<span class="st"> </span><span class="kw">as.factor</span>(DF$Trim_encoded)
DF &lt;-<span class="st"> </span>DF[,<span class="kw">c</span>(-<span class="dv">7</span>,-<span class="dv">8</span>,-<span class="dv">9</span>)]
DF &lt;-<span class="st"> </span>DF[,-<span class="dv">2</span>]</code></pre>
</div>
<div id="ratios-from-prices" class="section level2">
<h2>Ratios from prices</h2>
<p>The prices have to be stored as numeric values. First I calculate ratios from the average and specific prices of the cars. These are more normalied than the differences would be. Later on I calculate ratios from these price ratios and the cars age. I also normalize the prices by the standing of the odometer. I do normalizations by the vehicles cost and the warranty cost also. As a last step I calculate the ratio of the vehicle and warranty costs.</p>
<pre class="sourceCode r"><code class="sourceCode r">for (i in <span class="dv">14</span>:<span class="dv">21</span>){DF[,i] &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(DF[,i])}

DF$AcAuPrice &lt;-<span class="st"> </span>DF[,<span class="dv">15</span>]/DF[,<span class="dv">14</span>]
DF$AcRetPrice &lt;-<span class="st"> </span>DF[,<span class="dv">17</span>]/DF[,<span class="dv">16</span>]
DF$CurrAuPrice &lt;-<span class="st"> </span>DF[,<span class="dv">19</span>]/DF[,<span class="dv">18</span>]
DF$CurrRetPrice &lt;-<span class="st"> </span>DF[,<span class="dv">21</span>]/DF[,<span class="dv">20</span>]

DF$AcAuPriceOverAge &lt;-<span class="st"> </span>DF$AcAuPrice /<span class="st"> </span>DF$VehicleAge
DF$AcRetPriceOverAge &lt;-<span class="st"> </span>DF$AcRetPrice /<span class="st"> </span>DF$VehicleAge
DF$CurrAuPriceOverAge &lt;-<span class="st"> </span>DF$CurrAuPrice /<span class="st"> </span>DF$VehicleAge
DF$CurrRetPriceOverAge &lt;-<span class="st"> </span>DF$CurrRetPrice /<span class="st"> </span>DF$VehicleAge
DF$OdoOverage &lt;-<span class="st"> </span>DF$VehOdo /<span class="st"> </span>DF$VehicleAge

DF$AcAuPriceOverOdo &lt;-<span class="st"> </span>DF$AcAuPrice /<span class="st"> </span>DF$VehOdo
DF$AcRetPriceOverOdo &lt;-<span class="st"> </span>DF$AcRetPrice /<span class="st"> </span>DF$VehOdo
DF$CurrAuPriceOverOdo &lt;-<span class="st"> </span>DF$CurrAuPrice /<span class="st"> </span>DF$VehOdo
DF$CurrRetPriceOverOdo &lt;-<span class="st"> </span>DF$CurrRetPrice /<span class="st"> </span>DF$VehOdo

DF$AcAuPriceOverCost &lt;-<span class="st"> </span>DF$AcAuPrice /<span class="st"> </span>DF$VehBCost
DF$AcRetPriceOverCost &lt;-<span class="st"> </span>DF$AcRetPrice /<span class="st"> </span>DF$VehBCost
DF$CurrAuPriceOverCost &lt;-<span class="st"> </span>DF$CurrAuPrice /<span class="st"> </span>DF$VehBCost
DF$CurrRetPriceOverCost &lt;-<span class="st"> </span>DF$CurrRetPrice /<span class="st"> </span>DF$VehBCost

DF$AcAuPriceOverWarranty &lt;-<span class="st"> </span>DF$AcAuPrice /<span class="st"> </span>DF$WarrantyCost
DF$AcRetPriceOverWarranty &lt;-<span class="st"> </span>DF$AcRetPrice /<span class="st"> </span>DF$WarrantyCost
DF$CurrAuPriceOverWarranty &lt;-<span class="st"> </span>DF$CurrAuPrice /<span class="st"> </span>DF$WarrantyCost
DF$CurrRetPriceOverWarranty &lt;-<span class="st"> </span>DF$CurrRetPrice /<span class="st"> </span>DF$WarrantyCost

DF$CostRatio &lt;-<span class="st"> </span>DF$VehBCost /<span class="st"> </span>DF$WarrantyCost</code></pre>
</div>
<div id="dummies-from-factors" class="section level2">
<h2>Dummies from factors</h2>
<p>The factor variables can be transformed into dummies, this speeds up the use of randomforest and gradient boosting – and makes possible the use of neural networks. The dummy separation is applied on maker, day, year, month, the vehicle production date, color, nationality, the state, engine size and on the encoded trim variable. The original factors are dropped from the dataset.</p>
<pre class="sourceCode r"><code class="sourceCode r">DF&lt;-DF[,-<span class="kw">c</span>(<span class="dv">25</span>,<span class="dv">24</span>)]

DF &lt;-<span class="st"> </span><span class="kw">cbind</span>(DF,<span class="kw">dummy</span>(DF$Make))
DF &lt;-<span class="st"> </span><span class="kw">cbind</span>(DF,<span class="kw">dummy</span>(DF$Day))
DF &lt;-<span class="st"> </span><span class="kw">cbind</span>(DF,<span class="kw">dummy</span>(DF$Year))
DF &lt;-<span class="st"> </span><span class="kw">cbind</span>(DF,<span class="kw">dummy</span>(DF$Month))
DF &lt;-<span class="st"> </span><span class="kw">cbind</span>(DF,<span class="kw">dummy</span>(DF$VehYear))
DF &lt;-<span class="st"> </span><span class="kw">cbind</span>(DF,<span class="kw">dummy</span>(DF$Color))
DF &lt;-<span class="st"> </span><span class="kw">cbind</span>(DF,<span class="kw">dummy</span>(DF$Nationality))
DF &lt;-<span class="st"> </span><span class="kw">cbind</span>(DF,<span class="kw">dummy</span>(DF$VNST))
DF &lt;-<span class="st"> </span><span class="kw">cbind</span>(DF,<span class="kw">dummy</span>(DF$EngineSize))
DF &lt;-<span class="st"> </span><span class="kw">cbind</span>(DF,<span class="kw">dummy</span>(DF$Trim_encoded))

DF &lt;-<span class="st"> </span>DF[,-<span class="kw">c</span>(<span class="dv">3</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">11</span>,<span class="dv">24</span>,<span class="dv">43</span>,<span class="dv">51</span>,<span class="dv">52</span>,<span class="dv">53</span>,<span class="dv">54</span>)]</code></pre>
</div>
<div id="dropping-variables-without-variation" class="section level2">
<h2>Dropping variables without variation</h2>
<p>A number of possible predictors that can be used in solving the classification problem has no variation. This means that they are essentially useless for the later use. I drop these variables from the dataset because they only take memory. This is done in this step.</p>
<pre class="sourceCode r"><code class="sourceCode r">Dropout_lister &lt;-<span class="st"> </span><span class="kw">c</span>()

for (i in <span class="dv">1</span>:<span class="kw">ncol</span>(DF)){
  
  <span class="kw">print</span>(i)
  
  if (<span class="kw">unique</span>(DF[,i]) ==<span class="st"> </span><span class="dv">1</span>){Dropout_lister &lt;-<span class="st"> </span><span class="kw">rbind</span>(Dropout_lister, <span class="kw">c</span>(i))}
}</code></pre>
</div>
<div id="creating-the-dataset-used-for-machine-learning" class="section level2">
<h2>Creating the dataset used for machine learning</h2>
<p>The dataset is now ready for additional data exploration and machine learning. It is stored as a comma spearated values file without the rownames.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">write.csv</span>(DF,<span class="dt">file=</span><span class="st">&quot;Clean_dataset.csv&quot;</span>,<span class="dt">row.names=</span><span class="ot">FALSE</span>)</code></pre>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
